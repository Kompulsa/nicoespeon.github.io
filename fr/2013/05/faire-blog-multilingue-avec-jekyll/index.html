<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, minimum-scale=1.0"><meta name="description" content="Un petit état des lieux des choses à savoir et des astuces que je peux vous donner pour réaliser un blog multilingue avec Jekyll."><title>Faire un blog multilingue avec Jekyll | @nicoespeon</title><link rel="icon" href="/assets/img/icon.png"><link rel="author" href="https://plus.google.com/u/0/108378377887967941980"><!-- DNS prefetch for external resources --><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//platform.twitter.com"><link rel="dns-prefetch" href="//p.twitter.com"><link rel="dns-prefetch" href="//cdn.api.twitter.com"><link rel="dns-prefetch" href="//google-analytics.com"><link rel="stylesheet" href='http://fonts.googleapis.com/css?family=Snippet|Roboto:300,100,700'><link rel="stylesheet" href="/assets/css/nicoespeon.css" media="screen"><link rel="stylesheet" href="/assets/css/nicoespeon-print.css" media="print"></head><body><div id="site"><div class="container"><div class="grid"><div class="grid__item seven-tenths portable-one-whole" role="main"><header class="media" role="banner"><!-- Brand logo --><img src="http://www.gravatar.com/avatar/46978c87c5c75cea5d05a61fa8b7d95b" class="media__img img--circle" alt="My avatar" width="80" height="80" /><!-- Main navigation --><nav class="media__body" role="navigation"><ul class="nav nav--main"><li><a href="/fr/index.html">Accueil</a></li><li><a href="/fr/about.html">À propos</a></li><li><a href="/fr/projects.html">Projets</a></li><li><a href="/fr/worth-reading.html">A Lire</a></li><li><a href="/fr/prestations.html">Prestations</a></li></ul></nav><!-- /navigation --></header><!-- /header --><article role="main"><h1>Faire un blog multilingue avec Jekyll</h1><div class="media"><a href="https://twitter.com/share" class="twitter-share-button media__img--rev" data-text="Faire un blog multilingue avec Jekyll |" data-via="nicoespeon">Tweeter</a><div class="media__body brand-face zeta">(29 Mai, 2013)</div></div><p class="islet">Un petit état des lieux des choses à savoir et des astuces que je peux vous donner pour réaliser un blog multilingue avec Jekyll.</p><h2 id='_petit_retour_sur_jekyll'><span class='icon-reliability' /> Petit retour sur Jekyll</h2><p>J&#8217;ai commencé ce blog avec <a href='/fr/2013/04/faire-son-blog-avec-jekyll'>un article présentant Jekyll</a> et ce qui m&#8217;avait amené à ce choix.</p><p>Pour résumer l&#8217;intérêt de ce &#8220;générateur de site dynamique&#8221; par rapport à un CMS tout prêt tel que Wordpress, j&#8217;avais avancé les points suivants :</p><ul><li><p><strong>Pas besoin/envie de m&#8217;embêter avec une BDD</strong>. Restons simple et faisons du front-end.</p></li><li><p><strong>Pouvoir mettre mon site à jour quand je push sur Github</strong>. J&#8217;aurais évidemment pu mettre en place des hooks pour reproduire le même comportement sur un serveur, mais c&#8217;est totalement inutile grâce à Jekyll et <a href='https://help.github.com/categories/20/articles'>Github Pages</a>.</p></li><li><p><strong>Suivre les dernières tendances en matière de développement web</strong>. L&#8217;expérience Jekyll me paraissait donc tentante, j&#8217;ai succombé.</p></li></ul><p>Simplement, Jekyll est adapté pour du blogging&#8230; mais du blogging en anglais (et voui). Par défaut, il n&#8217;est donc pas vraiment optimisé pour le français et encore moins pour créer un blog multilingue.</p><p>Bien entendu, c&#8217;est tout à fait possible si l&#8217;on sait ruser et mettre un peu les mains dans le cambouis. Je me propose donc ici de vous expliquer les quelques étapes dont vous aurez besoin si vous souhaitez pouvoir blogger dans 2 langues, ou plus.</p><h2 id='_do_you_parler_franais_'><span class='icon-bubbles' /> Do you parler Français ?</h2><p>Le meilleur exemple de la nature <em>english oriented</em> de Jekyll est certainement <a href='http://liquid.rubyforge.org/classes/Liquid/StandardFilters.html#M000012'>le filtre Liquid <code>date</code></a>. Ce dernier permet de retourner très simplement la date de publication d&#8217;un post, par exemple, mais dans le format anglais ! Certes, si vous vous contentez des chiffres ça passera sans problème. En revanche ça risque de faire tâche d&#8217;avoir des <code>19 April, 2013</code> qui trainent un peu partout sur votre blog francophone.</p><p>Le deuxième soucis majeur se pose lorsque vous souhaitez <strong>distinguer les articles en fonction de leur langue</strong>, pour proposer 2 pages d&#8217;index différentes par exemple. La bonne idée qui vous vient, c&#8217;est naturellement de créer une catégorie par langue. Mais le <code>paginator</code> Jekyll, qui vous permet d&#8217;afficher le listing paginé des posts de votre site, n&#8217;a pas été créé pour gérer les catégories. Cela pose un léger soucis puisque vous allez vous retrouver à choisir entre :</p><ol><li>Tous les posts d&#8217;une catégorie, listés sur une seule page</li><li>Un listing de X posts par page, toutes catégories (langues) confondues</li></ol><p>Bref, autant d&#8217;obstacles qui pimentent un peu le challenge. Voyons comment s&#8217;en sortir malgré tout.</p><h4 id='parlons_stratgie'>Parlons stratégie</h4><p>Prenons le problème à l&#8217;envers, et définissons ce que nous souhaitons obtenir pour commencer :</p><ul><li>Nous voulons que l&#8217;anglais soit la langue par défaut, à la racine de projet.</li><li>Chaque langue représente une catégorie, ce qui peut être aisément retranscrit avec l&#8217;architecture des dossiers.</li><li>La partie française doit être accessible à partir de l&#8217;URL de base <code>/fr</code> (ce qui se goupille pas trop mal avec les précédentes considérations).</li><li>Les articles en anglais doivent être listés uniquement sur <code>index.html</code></li><li>Les articles en français doivent être listés uniquement sur <code>index.html/fr</code></li><li>La pagination doit gérer la distinction anglais/français.</li><li>Ca doit rester simple !</li></ul><p>Élaborons donc l&#8217;architecture de nos fichiers source d&#8217;après ce que nous venons de dire :</p><div class='highlight'><pre><code class='text'>.
|-- _includes/      # Bouts de codes inclus ailleurs
|-- _layouts/       # Templates du site
|-- _plugins/       # Plugins pour surcharger de Jekyll
|-- assets/         # LESS/CSS, JS, images, ...
|-- fr/             # Categorie FR
|   |-- _posts/     # Articles en français
|   |-- index.html  # Pages html en français
|   |-- about.html
|   |-- (...)
|
|-- en/             # Catégorie EN
|   |-- _posts/     # Articles en anglais
|
|-- index.html      # Pages html par défaut (EN)
|-- about.html
|-- (...)
|-- _config.yml     # Fichier de configuration de Jekyll
</code></pre></div><p>Lorsqu&#8217;il est lancé, Jekyll génère le site statique final dans le dossier <code>_site/</code>.</p><p class='islet'><strong>Note</strong> - Personnellement, j'utilise le fichier <code>_config.yml</code> pour y mettre des variables qui dépendent de la langue et que je réutilise dans les templates.<br /><br />Ce n'est pas <strong>la solution la plus propre</strong> selon moi, mais c'est assez facile à mettre en place et cela fonctionne plutôt bien pour le moment (tant qu'il n'y en a pas trop). Cela changera à l'avenir lorsque je me serais penché sur une manière plus élégante pour faire ça.</p><h2 id='_les_plugins_en_renfort'><span class='icon-gift' /> Les plugins en renfort</h2><p>Pour résoudre les problèmes que nous avons soulevé plus tôt, j&#8217;ai mis en place 2 petits plugins qui vont surcharger le workflow classique de Jekyll pour le plier à notre volonté (c&#8217;est qui l&#8217;patron ?).</p><h4 id='1_pagination_par_categorie'>1. Pagination par categorie</h4><p><a href='https://github.com/nicoespeon/nicoespeon.github.io/blob/develop/_plugins/category_pagination.rb'>category_pagination.rb</a> modifie le fonctionnement du <code>paginator</code> afin de prendre seulement en compte les articles qui correspondent à la catégorie spécifiée, et ainsi pouvoir distinguer les deux.</p><p>J&#8217;ai modifié le plugin original afin de définir l&#8217;anglais comme catégorie par défaut à la racine au lien d&#8217;afficher tous les <code>site.posts</code>.</p><h4 id='2_filtre_i18n'>2. Filtre i18n</h4><p><a href='https://github.com/nicoespeon/nicoespeon.github.io/blob/develop/_plugins/i18n_filter.rb'>i18n_filter.rb</a> customise le traitement de <code>page.date</code> en fonction de la langue.</p><p>J&#8217;ai du ajouter un fichier <a href='https://github.com/nicoespeon/nicoespeon.github.io/blob/develop/_locales/fr.yml'>_locales/fr.yml</a> afin de créer la fonction <code>localize</code>. Elle fonctionne de la même manière que <code>date</code> mais renvoie le format français de la date.</p><h2 id='_le_point_github'><span class='icon-github-2' /> Le point Github</h2><p>Les plugins sont installés, les templates sont élaborés, le design est mis en place, le git flow est prêt ainsi que le dépôt sur Github&#8230; <em>Pushons joyeusement !</em></p><p>Je constate que <a href='https://help.github.com/articles/setting-up-a-custom-domain-with-pages'>la redirection DNS de mon domaine perso</a> fonctionne à merveille mais&#8230; erf. Le résultat n&#8217;est vraiment pas celui attendu !</p><p>Yep, pour ceux qui l&#8217;auraient remarqué tout comme moi à ce moment là, Github lance Jekyll en mode <code>--safe</code>, ce qui veut dire que <strong>les plugins sont désactivés</strong>.</p><p>Au revoir pagination par catégorie et filtre i18n.</p><h4 id='a_chaque_problme_sa_solution_'>A chaque problème, sa solution &#8230;</h4><p>&#8230; et Google votre meilleur ami.</p><p><a href='http://charliepark.org/jekyll-with-plugins/'>J&#8217;ai pu trouver l&#8217;inspiration</a> pour redéfinir mon workflow git et contourner ce nouveau problème en ce qui me concerne. C&#8217;est ce que je vous propose très concrètement ci-dessous.</p><h4 id='un_petit_retour_sur_le_workflow_et_les_branches'>Un petit retour sur le workflow et les branches</h4><p>Nous allons considérer que notre workflow comporte 2 branches distinctes :</p><ol><li><p>La branche <code>master</code>, qui correspond au site final compilé. Il est généré par Jekyll dans le dossier <code>_site/</code> lors de la compilation et Github peut très bien héberger directement un site statique avec l&#8217;ajout <a href='https://github.com/nicoespeon/nicoespeon.github.io/blob/master/.nojekyll'>d&#8217;un fichier <code>.nojekyll</code></a>.</p></li><li><p>La branche <code>develop</code>, qui correspond aux fichiers sources puisque nous avons besoin de les versionner. Ces fichiers seront compilés par Jekyll lors du déploiement, afin de commiter le rendu sur la branche <code>master</code>.</p></li></ol><p>Il n&#8217;y a pas de merge de <code>develop</code> dans <code>master</code> avec ce workflow. Il s&#8217;agit de deux branches évoluant en parallèle avec une version source du code pour l&#8217;une, et compilée pour l&#8217;autre.</p><p>Le déploiement consiste à compiler le code source de la branche de développement (<code>develop</code>) et à venir committer ces changements sur la branche de production (<code>master</code>).</p><h4 id='deux_branches_parallles_wtf_'>Deux branches parallèles WTF ?</h4><p>Bien que cela sorte de la vision classique des branchements aka <em>&#8220;tout le modèle de branches part d&#8217;un ancêtre commun&#8221;</em>, Git permet également de créer de nouvelles branches n&#8217;ayant pas d&#8217;ancêtre commun avec le commit sur lequel nous nous trouvons. Un peu comme un nouveau projet dans le projet.</p><p>C&#8217;est ce que l&#8217;on appelle <strong>des branches orphelines</strong>.</p><p>Pour créer une telle branche, c&#8217;est très simple :</p><div class='highlight'><pre><code class='console'><span class='gp'>$</span> git checkout --orphan &lt;new branch&gt;
</code></pre></div><p>Dans notre cas, considérons donc que notre branche initiale (par défaut) soit <code>develop</code>. Il s&#8217;agit donc de créer une branche <code>master</code> depuis cette branche afin d&#8217;y versionner la version compilée de notre site :</p><div class='highlight'><pre><code class='console'><span class='gp'>$</span> git checkout --orphan master
</code></pre></div><p>Il suffit donc de considérer cette branche comme une version alternative de votre code.</p><p>Supprimez tout ce qui n&#8217;a rien à y faire (les fichiers sources) et faîtes en sorte d&#8217;y versionner le code final, compilé (celui qui se trouve normalement dans le répertoire <code>_site/</code> du code source).</p><p class='islet'>En ce qui me concerne, j'avais déjà pushé les premiers commits quand je me suis rendu compte de mon erreur. Mon workflow initial se basait sur des merge de <code>develop</code> dans <code>master</code>.<br /><br />Mais plutôt que de recréer l'ensemble du dépôt et de rebaser tout ça, j'ai décidé de conserver cet historique en corrigeant le tir avec quelques commits. Il n'y a pas à rougir de faire des erreurs après tout, c'est ainsi qu'on apprend.</p><h4 id='dployer_comme_un_prince'>Déployer comme un prince</h4><p>L&#8217;idée de base à présent, c&#8217;est de travailler sur vos fichiers sources dans <code>develop</code>. Puis, il faut que vous compiliez votre code, que vous changiez de branche, supprimiez ce qui n&#8217;a rien à faire là et ne conserviez que le code du site compilé final. La manière de procéder pour en arriver là est à votre entière disposition, tout dépend de votre façon de fonctionner.</p><p>Pour ma part, j&#8217;ai 2 solutions à vous proposer pour vous permettre de déployer tout ça plus facilement (= sans avoir à vous taper le process à la main) :</p><ol><li><p>Vous vous faîtes un petit script de build qui vous permet de faire tout ça en une ligne de commande. C&#8217;est le cas de <a href='https://github.com/nicoespeon/nicoespeon.github.io/blob/develop/Makefile'>mon Makefile</a> qui me permet de déployer en lançant un simple <code>make deploy</code> dans mon terminal. Libre à moi de pusher ensuite.</p></li><li><p>Vous pouvez aller jeter un oeil à <a href='https://github.com/prost87/git-publish-pages'>git publish</a> qui est un script que vous pouvez rajouter à Git et qui vous permettra de déployer des sites Jekyll avec ce workflow justement (quand on vous dit que d&#8217;autres y ont pensé avant vous).</p></li></ol><h2 id='_et_voil_'><span class='icon-point-right' /> Et voilà !</h2><p>Nous y voilà, cela devrait fonctionner parfaitement à présent. Avec ces petits conseils vous devriez être en mesure de faire votre blog Jekyll, hébergé sur Github et multilingue <em>\o/</em></p><p>Comme d&#8217;habitude, nhésitez pas à émettre commentaires, suggestions, remarques et autres questions qui vous trotteraient dans la tête, si besoin, ci-dessous.</p><p>Plop !</p><div id="disqus_thread" role="complementary"></div></article></div><div class="grid__item three-tenths portable-one-whole" role="complementary"><!-- Lang navigation --><nav role="navigation"><ul class="nav nav--stacked text--center"><li ><a href="/">English version</a></li><li class="current"><a href="/fr/">Version française</a></li></ul></nav><!-- About --><aside class="text--justify"><p>Je m'appelle <span class='brand-face'>Nicolas</span> et je suis étudiant d'une école de commerce orientée IT, développeur web en freelance à mes heures.</p><p>Je <a href='/archive'>rédige</a> des articles sur le développement web et la gestion de projets. Je suis <a href='http://www.linkedin.com/profile/view?id=143126897'>LinkedIn</a>, je <a href='https://delicious.com/nicoespeon'>tague</a> et je <a href='http://twitter.com/nicoespeon'>tweet</a> pas mal aussi.</p></aside><!-- RSS --><aside><p class="text--center"><a href="http://nicoespeon.com/feed.xml"><i class="icon-connection"></i>&nbsp;Restez connectés</a></p></aside><!-- Tweets --><aside class="text--center visuallyhidden--portable"><a class="twitter-timeline" href="https://twitter.com/nicoespeon" data-widget-id="320422386929377280">Tweets de @nicoespeon</a></aside></div></div></div><!-- /container --></div><!-- /main-content --><footer role="contentinfo"><div class="container"><p>&copy; 2013 - <a href="https://twitter.com/nicoespeon">Nicolas (Espeon) Carlo</a><br>Ce site est construit grâce à <a href='https://github.com/mojombo/jekyll'>Jekyll</a> et à <a href='http://inuitcss.com/'>inuit.css</a> de l'excellent <a href='https://twitter.com/csswizardry'>@csswizardry</a>. Le code source est <a href='https://github.com/nicoespeon/nicoespeon.github.io'>hébergé sur GitHub</a>.</p></div></footer><!-- Twitter API --><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script><!-- Google Analytics --><script>var _gaq = _gaq || [];_gaq.push(['_setAccount', 'UA-39957541-2']);_gaq.push(['_setDomainName', 'nicoespeon.com']);_gaq.push(['_trackPageview']);(function() {var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script><!-- Disqus --><script>var disqus_shortname = 'nicoespeon';var disqus_url = 'http://nicoespeon.com/fr/2013/05/faire-blog-multilingue-avec-jekyll';var title = "Faire un blog multilingue avec Jekyll";(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></body></html>